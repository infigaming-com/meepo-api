syntax = "proto3";

package api.report.service.v1;

import "google/api/annotations.proto";
import "common/common.proto";
import "backoffice/service/v1/backoffice_report.proto";

option go_package = "github.com/infigaming-com/meepo-api/report/service/v1;v1";
option java_multiple_files = true;
option java_package = "api.report.service.v1";

// Internal Request messages for gRPC communication between services
// These messages include operator_context field which MUST NOT be exposed to frontend

message GetSummaryRequest {
	api.backoffice.service.v1.TimeRange time_range = 1;
	api.common.OperatorContextFilters operator_context_filters = 2;
	api.common.OperatorContext operator_context = 3;  // Internal only - injected by backoffice-service
	repeated string affiliate_codes = 5;
	repeated string referral_codes = 6;
	repeated string registration_countries = 7;
}

message ListSummariesRequest {
	api.backoffice.service.v1.TimeRange time_range = 1;
	api.common.OperatorContextFilters operator_context_filters = 2;
	api.common.OperatorContext operator_context = 3;  // Internal only
	repeated string affiliate_codes = 5;
	repeated string referral_codes = 6;
	repeated string registration_countries = 7;
	optional int32 page = 8;
	optional int32 page_size = 9;
}

message GetGameSummaryRequest {
	api.backoffice.service.v1.TimeRange time_range = 1;
	api.common.OperatorContextFilters operator_context_filters = 2;
	repeated string provider_ids = 3;
	repeated string game_categories = 4;
	repeated string game_names = 5;
	repeated string game_ids = 6;
	repeated string currencies = 7;
	api.common.OperatorContext operator_context = 8;  // Internal only
}

message ListGameDataRequest {
	api.backoffice.service.v1.TimeRange time_range = 1;
	api.common.OperatorContextFilters operator_context_filters = 2;
	repeated string provider_ids = 3;
	repeated string game_categories = 4;
	repeated string game_names = 5;
	repeated string game_ids = 6;
	repeated string currencies = 7;
	int32 page = 8;
	int32 page_size = 9;
	api.common.OperatorContext operator_context = 10;  // Internal only
}

message GetPlayerGameSummaryRequest {
	api.backoffice.service.v1.TimeRange time_range = 1;
	api.common.OperatorContextFilters operator_context_filters = 2;
	repeated string provider_ids = 3;
	repeated string game_categories = 4;
	repeated string game_tags = 5;
	repeated string game_names = 6;
	repeated string game_ids = 7;
	repeated string currencies = 8;
	repeated int64 user_ids = 9;
	api.common.OperatorContext operator_context = 10;  // Internal only
}

message ListPlayerGameDataRequest {
	api.backoffice.service.v1.TimeRange time_range = 1;
	api.common.OperatorContextFilters operator_context_filters = 2;
	repeated string provider_ids = 3;
	repeated string game_categories = 4;
	repeated string game_tags = 5;
	repeated string game_names = 6;
	repeated string game_ids = 7;
	repeated string currencies = 8;
	repeated int64 user_ids = 9;
	int32 page = 10;
	int32 page_size = 11;
	api.common.OperatorContext operator_context = 12;  // Internal only
}

message GetDepositSummariesRequest {
	api.backoffice.service.v1.TimeRange time_range = 1;
	api.common.OperatorContextFilters operator_context_filters = 2;
	api.common.OperatorContext operator_context = 3;  // Internal only
	repeated string currencies = 5;
}

message GetWithdrawSummariesRequest {
	api.backoffice.service.v1.TimeRange time_range = 1;
	api.common.OperatorContextFilters operator_context_filters = 2;
	api.common.OperatorContext operator_context = 3;  // Internal only
	repeated string currencies = 5;
}

message ListDepositDetailsRequest {
	api.backoffice.service.v1.TimeRange time_range = 1;
	api.common.OperatorContextFilters operator_context_filters = 2;
	api.common.OperatorContext operator_context = 3;  // Internal only
	repeated string currencies = 5;
	optional int32 page = 6;
	optional int32 page_size = 7;
}

message ListWithdrawDetailsRequest {
	api.backoffice.service.v1.TimeRange time_range = 1;
	api.common.OperatorContextFilters operator_context_filters = 2;
	api.common.OperatorContext operator_context = 3;  // Internal only
	repeated string currencies = 5;
	optional int32 page = 6;
	optional int32 page_size = 7;
}

message ListRegisterRetentionRequest {
	api.backoffice.service.v1.TimeRange time_range = 1;
	api.common.OperatorContextFilters operator_context_filters = 2;
	int32 page = 3;
	int32 page_size = 4;
	api.common.OperatorContext operator_context = 5;  // Internal only
}

message ListDepositVtgDetailsRequest {
	api.backoffice.service.v1.TimeRange time_range = 1;
	api.common.OperatorContextFilters operator_context_filters = 2;
	repeated string currencies = 3;
	int32 page = 4;
	int32 page_size = 5;
	api.common.OperatorContext operator_context = 6;  // Internal only
}

message ListWithdrawVtgDetailsRequest {
	api.backoffice.service.v1.TimeRange time_range = 1;
	api.common.OperatorContextFilters operator_context_filters = 2;
	repeated string currencies = 3;
	int32 page = 4;
	int32 page_size = 5;
	api.common.OperatorContext operator_context = 6;  // Internal only
}

// ReportService provides analytics and reporting functionality via ClickHouse.
// This service is the ONLY service allowed to query ClickHouse directly.
service ReportService {
  // Summary reports
  rpc GetSummary(GetSummaryRequest) returns (api.backoffice.service.v1.GetSummaryResponse) {
    option (google.api.http) = {
      post: "/v1/report/summary/get"
      body: "*"
    };
  }

  rpc ListSummaries(ListSummariesRequest) returns (api.backoffice.service.v1.ListSummariesResponse) {
    option (google.api.http) = {
      post: "/v1/report/summary/list"
      body: "*"
    };
  }

  // Game data reports
  rpc GetGameDataSummary(GetGameSummaryRequest) returns (api.backoffice.service.v1.GetGameSummaryResponse) {
    option (google.api.http) = {
      post: "/v1/report/game-data/get"
      body: "*"
    };
  }

  rpc ListGameData(ListGameDataRequest) returns (api.backoffice.service.v1.ListGameDataResponse) {
    option (google.api.http) = {
      post: "/v1/report/game-data/list"
      body: "*"
    };
  }

  // Player game data reports
  rpc GetPlayerGameDataSummary(GetPlayerGameSummaryRequest) returns (api.backoffice.service.v1.GetPlayerGameSummaryResponse) {
    option (google.api.http) = {
      post: "/v1/report/player-game-data/get"
      body: "*"
    };
  }

  rpc ListPlayerGameData(ListPlayerGameDataRequest) returns (api.backoffice.service.v1.ListPlayerGameDataResponse) {
    option (google.api.http) = {
      post: "/v1/report/player-game-data/list"
      body: "*"
    };
  }

  // Retention reports
  rpc ListRegisterRetention(ListRegisterRetentionRequest) returns (api.backoffice.service.v1.ListRegisterRetentionResponse) {
    option (google.api.http) = {
      post: "/v1/report/register-retention/list"
      body: "*"
    };
  }

  // Deposit reports
  rpc GetDepositSummaries(GetDepositSummariesRequest) returns (api.backoffice.service.v1.GetDepositSummariesResponse) {
    option (google.api.http) = {
      post: "/v1/report/deposit-summaries/get"
      body: "*"
    };
  }

  rpc ListDepositDetails(ListDepositDetailsRequest) returns (api.backoffice.service.v1.ListDepositDetailsResponse) {
    option (google.api.http) = {
      post: "/v1/report/deposit-details/list"
      body: "*"
    };
  }

  rpc ListDepositVtgDetails(ListDepositVtgDetailsRequest) returns (api.backoffice.service.v1.ListDepositVtgDetailsResponse) {
    option (google.api.http) = {
      post: "/v1/report/deposit-vtg-details/list"
      body: "*"
    };
  }

  // Withdrawal reports
  rpc GetWithdrawSummaries(GetWithdrawSummariesRequest) returns (api.backoffice.service.v1.GetWithdrawSummariesResponse) {
    option (google.api.http) = {
      post: "/v1/report/withdraw-summaries/get"
      body: "*"
    };
  }

  rpc ListWithdrawDetails(ListWithdrawDetailsRequest) returns (api.backoffice.service.v1.ListWithdrawDetailsResponse) {
    option (google.api.http) = {
      post: "/v1/report/withdraw-details/list"
      body: "*"
    };
  }

  rpc ListWithdrawVtgDetails(ListWithdrawVtgDetailsRequest) returns (api.backoffice.service.v1.ListWithdrawVtgDetailsResponse) {
    option (google.api.http) = {
      post: "/v1/report/withdraw-vtg-details/list"
      body: "*"
    };
  }

  // Sport events (may need different implementation)
  rpc ListSportEvents(api.backoffice.service.v1.ListSportEventsRequest) returns (api.backoffice.service.v1.ListSportEventsResponse) {
    option (google.api.http) = {
      post: "/v1/report/sport-events/list"
      body: "*"
    };
  }

  // Customer record detail
  rpc CustomerRecordReportDetail(api.backoffice.service.v1.CustomerRecordReportDetailRequest) returns (api.backoffice.service.v1.CustomerRecordReportDetailResponse) {
    option (google.api.http) = {
      post: "/v1/report/customer-record/get"
      body: "*"
    };
  }
}
