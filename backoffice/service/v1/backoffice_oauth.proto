syntax = "proto3";

package api.backoffice.service.v1;

import "google/api/annotations.proto";
import "common/common.proto";
import "user/service/v1/user.proto";

option go_package = "github.com/infigaming-com/meepo-api/backoffice/service/v1;v1";
option java_multiple_files = true;
option java_package = "api.backoffice.service.v1";

// BackofficeOAuth service provides OAuth provider configuration management for operators
service BackofficeOAuth {
	// Create or update OAuth provider configuration
	rpc CreateOrUpdateOAuthProviderConfig(CreateOrUpdateOAuthProviderConfigRequest) returns (CreateOrUpdateOAuthProviderConfigResponse) {
		option (google.api.http) = {
			post: "/v1/backoffice/oauth/provider/createorupdate"
			body: "*"
		};
	}

	// Delete an OAuth provider configuration
	rpc DeleteOAuthProviderConfig(DeleteOAuthProviderConfigRequest) returns (DeleteOAuthProviderConfigResponse) {
		option (google.api.http) = {
			post: "/v1/backoffice/oauth/provider/delete"
			body: "*"
		};
	}

	// Enable or disable an OAuth provider
	rpc SetOAuthProviderEnabled(SetOAuthProviderEnabledRequest) returns (SetOAuthProviderEnabledResponse) {
		option (google.api.http) = {
			post: "/v1/backoffice/oauth/provider/enabled/set"
			body: "*"
		};
	}

	// List all OAuth provider configurations for an operator
	rpc ListOAuthProviderConfigs(ListOAuthProviderConfigsRequest) returns (ListOAuthProviderConfigsResponse) {
		option (google.api.http) = {
			post: "/v1/backoffice/oauth/provider/list"
			body: "*"
		};
	}

	// Get a specific OAuth provider configuration
	rpc GetOAuthProviderConfig(GetOAuthProviderConfigRequest) returns (GetOAuthProviderConfigResponse) {
		option (google.api.http) = {
			post: "/v1/backoffice/oauth/provider/get"
			body: "*"
		};
	}

	// ============ Telegram Configuration Management ============
	// Create or update Telegram configuration
	rpc CreateOrUpdateTelegramConfig(CreateOrUpdateTelegramConfigRequest) returns (CreateOrUpdateTelegramConfigResponse) {
		option (google.api.http) = {
			post: "/v1/backoffice/telegram/config/createorupdate"
			body: "*"
		};
	}

	// Get Telegram configuration
	rpc GetTelegramConfig(GetTelegramConfigRequest) returns (GetTelegramConfigResponse) {
		option (google.api.http) = {
			post: "/v1/backoffice/telegram/config/get"
			body: "*"
		};
	}

	// Delete Telegram configuration
	rpc DeleteTelegramConfig(DeleteTelegramConfigRequest) returns (DeleteTelegramConfigResponse) {
		option (google.api.http) = {
			post: "/v1/backoffice/telegram/config/delete"
			body: "*"
		};
	}

	// Enable or disable Telegram auth
	rpc SetTelegramEnabled(SetTelegramEnabledRequest) returns (SetTelegramEnabledResponse) {
		option (google.api.http) = {
			post: "/v1/backoffice/telegram/config/enabled/set"
			body: "*"
		};
	}
}

// CreateOrUpdateOAuthProviderConfigRequest - request to create or update OAuth provider config
// If config_id is provided (non-zero), updates existing config; otherwise creates new one
message CreateOrUpdateOAuthProviderConfigRequest {
	api.common.OperatorContext target_operator_context = 1;
	optional int64 config_id = 2;          // If provided, update existing config; otherwise create new
	user.service.v1.OAuthProvider provider = 3;
	string client_id = 4;
	optional string client_secret = 5;     // Required for create, optional for update
	map<string, string> config = 6;        // Provider-specific config (scopes, redirect_uri, etc.)
	bool enabled = 7;
	bool allow_registration = 8;
	bool allow_linking = 9;
	repeated int64 allowed_role_ids = 10;
	int32 rate_limit_per_minute = 11;
}

message CreateOrUpdateOAuthProviderConfigResponse {
	int64 config_id = 1;
	bool created = 2;                      // True if created, false if updated
}

// DeleteOAuthProviderConfigRequest - request to delete OAuth provider config
message DeleteOAuthProviderConfigRequest {
	api.common.OperatorContext target_operator_context = 1;
	int64 config_id = 2;
}

message DeleteOAuthProviderConfigResponse {}

// SetOAuthProviderEnabledRequest - request to enable/disable OAuth provider
message SetOAuthProviderEnabledRequest {
	api.common.OperatorContext target_operator_context = 1;
	int64 config_id = 2;
	bool enabled = 3;
}

message SetOAuthProviderEnabledResponse {}

// ListOAuthProviderConfigsRequest - request to list OAuth provider configs
message ListOAuthProviderConfigsRequest {
	api.common.OperatorContext target_operator_context = 1;
	optional user.service.v1.OAuthProvider provider = 2;  // Filter by provider
	optional bool enabled = 3;  // Filter by enabled status
}

message ListOAuthProviderConfigsResponse {
	repeated user.service.v1.OAuthProviderConfig configs = 1;
}

// GetOAuthProviderConfigRequest - request to get specific OAuth provider config
message GetOAuthProviderConfigRequest {
	api.common.OperatorContext target_operator_context = 1;
	int64 config_id = 2;
}

message GetOAuthProviderConfigResponse {
	user.service.v1.OAuthProviderConfig config = 1;
}

// ============================================================================
// Telegram Configuration Messages for Backoffice
// ============================================================================

// CreateOrUpdateTelegramConfigRequest - request to create or update Telegram config
message CreateOrUpdateTelegramConfigRequest {
	api.common.OperatorContext target_operator_context = 1;
	optional int64 config_id = 2;          // If provided, update existing config; otherwise create new
	string bot_token = 3;                  // Required for create, optional for update
	string bot_username = 4;
	bool enabled = 5;
	bool allow_registration = 6;
	bool allow_linking = 7;
	int32 auth_date_validity_seconds = 8;
}

message CreateOrUpdateTelegramConfigResponse {
	int64 config_id = 1;
	bool created = 2;                      // True if created, false if updated
}

// DeleteTelegramConfigRequest - request to delete Telegram config
message DeleteTelegramConfigRequest {
	api.common.OperatorContext target_operator_context = 1;
	int64 config_id = 2;
}

message DeleteTelegramConfigResponse {}

// SetTelegramEnabledRequest - request to enable/disable Telegram auth
message SetTelegramEnabledRequest {
	api.common.OperatorContext target_operator_context = 1;
	int64 config_id = 2;
	bool enabled = 3;
}

message SetTelegramEnabledResponse {}

// GetTelegramConfigRequest - request to get Telegram config
message GetTelegramConfigRequest {
	api.common.OperatorContext target_operator_context = 1;
}

message GetTelegramConfigResponse {
	user.service.v1.TelegramConfig config = 1;
}
